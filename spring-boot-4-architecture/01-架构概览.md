# Spring Boot 4.0 架构概览

## 一、技术基线

| 组件 | 版本要求 |
|------|----------|
| **Java** | 17+ (支持至 Java 25) |
| **Spring Framework** | 7.0 |
| **Jakarta EE** | 11 |
| **Kotlin** | 2.2 |
| **Servlet** | 6.1 |

## 二、整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Spring Boot 4.0 整体架构                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         应用层 (Application Layer)                       │   │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │   │
│  │  │  用户代码    │ │  配置类      │ │  自定义Bean  │ │  业务逻辑    │   │   │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│                                      ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    Spring Boot 自动配置层 (70+ 模块)                      │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │   │
│  │  │ WebMVC   │ │ WebFlux  │ │ Security │ │   Data   │ │ Actuator │     │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │   │
│  │  │  Batch   │ │ Messaging│ │  Cache   │ │  OpenTel │ │  GraphQL │     │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│                                      ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      Spring Framework 7.0 核心                           │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │                    IoC 容器 / 依赖注入                            │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │   │
│  │  │  Core    │ │  Beans   │ │ Context  │ │   AOP    │ │   SpEL   │     │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│                                      ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         基础设施层                                       │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │   │
│  │  │  JVM     │ │ Jakarta  │ │ Database │ │ Message  │ │  Cache   │     │   │
│  │  │ Runtime  │ │  EE 11   │ │  Server  │ │  Broker  │ │  Server  │     │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 三、Spring Boot 4.0 核心升级

### 3.1 依赖版本升级

| Spring 项目 | 版本 |
|------------|------|
| Spring Framework | 7.0 |
| Spring Data | 2025.1 |
| Spring Security | 7.0 |
| Spring Session | 4.0 |
| Spring Batch | 6.0 |
| Spring AMQP | 4.0 |
| Spring Integration | 7.0 |
| Spring for Apache Kafka | 4.0 |
| Spring for Apache Pulsar | 2.0 |
| Spring GraphQL | 2.0 |
| Spring HATEOAS | 3.0 |
| Spring LDAP | 4.0 |
| Spring REST Docs | 4.0 |
| Spring WS | 5.0 |
| Micrometer | 1.16 |
| Micrometer Tracing | 1.6 |
| Reactor | 2025.0 |

### 3.2 关键新特性

```
┌─────────────────────────────────────────────────────────────────┐
│                    Spring Boot 4.0 新特性                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │   模块化架构     │    │   API 版本控制   │                    │
│  │   70+ 独立模块   │    │  @RequestMapping │                    │
│  │   更小的JAR包    │    │   version属性    │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │  JSpecify空安全  │    │  RestTestClient │                    │
│  │   全栈空值检查   │    │   新测试工具     │                    │
│  │   Kotlin友好    │    │  真实HTTP测试    │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │  OpenTelemetry  │    │   HTTP Service  │                    │
│  │   原生支持      │    │    Clients      │                    │
│  │   OTLP导出      │    │   声明式客户端   │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 四、与 Spring Boot 3.x 的对比

| 特性 | Spring Boot 3.x | Spring Boot 4.0 |
|------|-----------------|-----------------|
| 自动配置 JAR | 单体 2MB | 70+ 独立模块 |
| Java 版本 | 17+ | 17+ (支持至 25) |
| Jakarta EE | 10 | 11 |
| Kotlin 版本 | 1.9+ | 2.2 |
| 空安全 | 有限支持 | JSpecify 全面支持 |
| API 版本控制 | 手动实现 | 内置支持 |
| 可观测性 | 良好 | OpenTelemetry 原生 |
| Undertow | 支持 | 已移除 |

## 五、快速开始

```xml
<!-- pom.xml -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>4.0.0</version>
</parent>

<dependencies>
    <!-- Web MVC (替代原来的 spring-boot-starter-web) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webmvc</artifactId>
    </dependency>

    <!-- 测试 -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webmvc-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

```gradle
// build.gradle
plugins {
    id 'org.springframework.boot' version '4.0.0'
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-webmvc'
    testImplementation 'org.springframework.boot:spring-boot-starter-webmvc-test'
}
```
