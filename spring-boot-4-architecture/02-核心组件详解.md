# Spring Boot 4.0 核心组件详解

## 一、组件分类总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Spring Boot 4.0 组件分类                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                           核心组件                                   │   │
│  │  • spring-boot                    • spring-boot-autoconfigure       │   │
│  │  • spring-boot-actuator           • spring-boot-devtools            │   │
│  │  • spring-boot-loader             • spring-boot-test                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐       │
│  │     Web 组件      │  │     数据组件       │  │    消息组件       │       │
│  │  • WebMVC        │  │  • Data JPA       │  │  • AMQP          │       │
│  │  • WebFlux       │  │  • Data MongoDB   │  │  • Kafka         │       │
│  │  • GraphQL       │  │  • Data Redis     │  │  • Pulsar        │       │
│  │  • HATEOAS       │  │  • Data R2DBC     │  │  • JMS           │       │
│  │  • REST Docs     │  │  • Data JDBC      │  │  • RSocket       │       │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘       │
│                                                                             │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐       │
│  │    安全组件       │  │    可观测性组件    │  │    批处理组件     │       │
│  │  • Security      │  │  • Actuator       │  │  • Batch         │       │
│  │  • OAuth2        │  │  • Micrometer     │  │  • Integration   │       │
│  │  • LDAP          │  │  • OpenTelemetry  │  │  • Quartz        │       │
│  │  • Session       │  │  • Prometheus     │  │  • Task          │       │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 二、核心启动组件

### 2.1 spring-boot

Spring Boot 的核心模块，提供：

```
spring-boot
├── SpringApplication          # 应用启动入口
├── SpringBootConfiguration    # 配置注解
├── @SpringBootApplication     # 组合注解
├── ApplicationRunner          # 启动后执行
├── CommandLineRunner          # 命令行启动
└── Environment                # 环境抽象
```

### 2.2 spring-boot-autoconfigure

自动配置核心（现已模块化为 70+ 子模块）：

```
spring-boot-autoconfigure
├── @EnableAutoConfiguration    # 开启自动配置
├── @Conditional*              # 条件注解族
│   ├── @ConditionalOnClass
│   ├── @ConditionalOnBean
│   ├── @ConditionalOnProperty
│   └── @ConditionalOnMissingBean
├── AutoConfiguration.imports   # 自动配置注册
└── 各技术领域的AutoConfiguration类
```

### 2.3 spring-boot-actuator

生产级监控和管理：

```
spring-boot-actuator
├── 端点 (Endpoints)
│   ├── /health              # 健康检查
│   ├── /info                # 应用信息
│   ├── /metrics             # 指标数据
│   ├── /env                 # 环境变量
│   ├── /beans               # Bean 列表
│   ├── /mappings            # 请求映射
│   ├── /loggers             # 日志级别
│   └── /threaddump          # 线程转储
├── 健康指示器 (Health Indicators)
│   ├── DiskSpaceHealthIndicator
│   ├── DataSourceHealthIndicator
│   ├── MongoHealthIndicator
│   └── RedisHealthIndicator
└── 指标收集 (Metrics)
    ├── JVM 指标
    ├── 系统指标
    ├── HTTP 指标
    └── 自定义指标
```

## 三、Web 组件

### 3.1 Spring WebMVC

```
┌─────────────────────────────────────────────────────────────────┐
│                    Spring WebMVC 架构                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   HTTP Request                                                  │
│        │                                                        │
│        ▼                                                        │
│  ┌─────────────────┐                                           │
│  │ DispatcherServlet│                                           │
│  └─────────────────┘                                           │
│        │                                                        │
│        ├──────────────┬──────────────┬──────────────┐          │
│        ▼              ▼              ▼              ▼          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ Handler  │  │ Handler  │  │  View    │  │ Exception│       │
│  │ Mapping  │  │ Adapter  │  │ Resolver │  │ Resolver │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
│        │                                                        │
│        ▼                                                        │
│  ┌─────────────────┐                                           │
│  │   @Controller    │                                           │
│  │ @RestController  │                                           │
│  └─────────────────┘                                           │
│        │                                                        │
│        ▼                                                        │
│  ┌─────────────────┐                                           │
│  │    Service      │                                           │
│  └─────────────────┘                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Spring Boot 4 新特性 - API 版本控制：**

```java
@RestController
public class UserController {

    @GetMapping(value = "/users", version = "1")
    public List<UserV1> getUsersV1() {
        // V1 API
    }

    @GetMapping(value = "/users", version = "2")
    public List<UserV2> getUsersV2() {
        // V2 API
    }
}
```

### 3.2 Spring WebFlux

响应式 Web 框架：

```
┌─────────────────────────────────────────────────────────────────┐
│                   Spring WebFlux 架构                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   HTTP Request (Non-Blocking)                                   │
│        │                                                        │
│        ▼                                                        │
│  ┌─────────────────────────────────────────┐                   │
│  │         HttpHandler / WebHandler         │                   │
│  └─────────────────────────────────────────┘                   │
│        │                                                        │
│        ├─────────────────────────┐                             │
│        ▼                         ▼                             │
│  ┌──────────────┐        ┌──────────────┐                      │
│  │  注解模式    │        │  函数式路由   │                      │
│  │@RestController│       │  RouterFunction│                     │
│  └──────────────┘        └──────────────┘                      │
│        │                         │                             │
│        └─────────┬───────────────┘                             │
│                  ▼                                             │
│  ┌─────────────────────────────────────────┐                   │
│  │          Reactive Streams               │                   │
│  │      Mono<T> / Flux<T> (Reactor)        │                   │
│  └─────────────────────────────────────────┘                   │
│                  │                                             │
│                  ▼                                             │
│  ┌─────────────────────────────────────────┐                   │
│  │          Netty / Undertow / Tomcat      │                   │
│  └─────────────────────────────────────────┘                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 四、数据访问组件

### 4.1 Spring Data 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    Spring Data 2025.1                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  Repository 抽象层                       │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │ Repository   │  │ CrudRepo     │  │ PagingRepo   │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                 │
│         ┌────────────────────┼────────────────────┐           │
│         ▼                    ▼                    ▼           │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐     │
│  │  Spring Data │    │  Spring Data │    │  Spring Data │     │
│  │     JPA      │    │   MongoDB    │    │    Redis     │     │
│  └──────────────┘    └──────────────┘    └──────────────┘     │
│         │                    │                    │           │
│         ▼                    ▼                    ▼           │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐     │
│  │   Hibernate  │    │   MongoDB    │    │    Lettuce   │     │
│  │     ORM      │    │    Driver    │    │    Driver    │     │
│  └──────────────┘    └──────────────┘    └──────────────┘     │
│                                                                 │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐     │
│  │  Spring Data │    │  Spring Data │    │  Spring Data │     │
│  │     JDBC     │    │    R2DBC     │    │Elasticsearch │     │
│  └──────────────┘    └──────────────┘    └──────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 数据库支持

| 数据库类型 | Spring Data 模块 | 驱动 |
|-----------|-----------------|------|
| PostgreSQL | Data JPA/JDBC | PostgreSQL JDBC |
| MySQL | Data JPA/JDBC | MySQL Connector |
| Oracle | Data JPA/JDBC | Oracle JDBC |
| MongoDB | Data MongoDB | MongoDB Driver |
| Redis | Data Redis | Lettuce |
| Elasticsearch | Data Elasticsearch | REST Client |
| Neo4j | Data Neo4j | Neo4j Driver |
| Cassandra | Data Cassandra | DataStax Driver |

## 五、安全组件

### 5.1 Spring Security 7.0

```
┌─────────────────────────────────────────────────────────────────┐
│                   Spring Security 7.0 架构                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   HTTP Request                                                  │
│        │                                                        │
│        ▼                                                        │
│  ┌─────────────────────────────────────────┐                   │
│  │         Security Filter Chain            │                   │
│  │  ┌─────────────────────────────────────┐│                   │
│  │  │ DisableEncodeUrlFilter             ││                   │
│  │  │ WebAsyncManagerIntegrationFilter   ││                   │
│  │  │ SecurityContextHolderFilter        ││                   │
│  │  │ HeaderWriterFilter                 ││                   │
│  │  │ CsrfFilter                         ││                   │
│  │  │ LogoutFilter                       ││                   │
│  │  │ UsernamePasswordAuthFilter         ││                   │
│  │  │ OAuth2LoginAuthFilter              ││                   │
│  │  │ BearerTokenAuthFilter              ││                   │
│  │  │ ExceptionTranslationFilter         ││                   │
│  │  │ AuthorizationFilter                ││                   │
│  │  └─────────────────────────────────────┘│                   │
│  └─────────────────────────────────────────┘                   │
│                              │                                 │
│         ┌────────────────────┼────────────────────┐           │
│         ▼                    ▼                    ▼           │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐     │
│  │Authentication│    │Authorization │    │   Session    │     │
│  │   Manager    │    │   Manager    │    │  Management  │     │
│  └──────────────┘    └──────────────┘    └──────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 六、可观测性组件

### 6.1 OpenTelemetry (新增)

Spring Boot 4 新增原生 OpenTelemetry 支持：

```
┌─────────────────────────────────────────────────────────────────┐
│                   可观测性三支柱                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐       │
│  │    Metrics    │  │    Traces     │  │     Logs      │       │
│  │    (指标)     │  │    (追踪)     │  │    (日志)     │       │
│  └───────────────┘  └───────────────┘  └───────────────┘       │
│         │                  │                  │                │
│         └──────────────────┼──────────────────┘                │
│                            ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   OpenTelemetry SDK                      │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │  │MeterProvider│  │TraceProvider│  │LogProvider  │     │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                            │                                   │
│                            ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    OTLP Exporter                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                            │                                   │
│         ┌──────────────────┼──────────────────┐               │
│         ▼                  ▼                  ▼               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │  Prometheus  │  │    Jaeger    │  │     Loki     │        │
│  │   Grafana    │  │    Zipkin    │  │    Splunk    │        │
│  └──────────────┘  └──────────────┘  └──────────────┘        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**配置示例：**

```yaml
# application.yml
management:
  otlp:
    metrics:
      export:
        enabled: true
        endpoint: http://otel-collector:4318/v1/metrics
    tracing:
      export:
        enabled: true
        endpoint: http://otel-collector:4318/v1/traces
```

## 七、测试组件

### 7.1 RestTestClient (新增)

Spring Boot 4 新增的测试工具：

```
┌─────────────────────────────────────────────────────────────────┐
│                    测试工具对比                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                      MockMvc                               │ │
│  │  • 不启动服务器        • 快速                              │ │
│  │  • 模拟HTTP请求        • 无法测试真实HTTP                  │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                   WebTestClient                            │ │
│  │  • 支持响应式         • 需要启动服务器                     │ │
│  │  • 真实HTTP请求       • 较慢                               │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │               RestTestClient (Spring Boot 4 新增)          │ │
│  │  • MockMvc速度        • 真实HTTP语义                       │ │
│  │  • 统一API            • 支持阻塞式编程                     │ │
│  │  • 两全其美           • 推荐使用                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**使用示例：**

```java
@SpringBootTest
class UserControllerTest {

    @Autowired
    RestTestClient restTestClient;

    @Test
    void shouldGetUsers() {
        restTestClient.get()
            .uri("/api/users")
            .exchange()
            .expectStatus().isOk()
            .expectBody()
            .jsonPath("$[0].name").isEqualTo("John");
    }
}
```
